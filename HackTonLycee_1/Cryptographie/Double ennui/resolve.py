import binascii
from Crypto.Util.number import long_to_bytes, inverse

# Données extraites du fichier output.txt
e = 3
n = 19840207208126052393050896123146445177805496265783874787555366857858516052935330306960403961592183751473373113336783003952286599270668928793068877549204823999940315119026834518475426746219794590844048907445041555571500802385655006431029757413493018670534847049116864361020139588952019885318063687075377599454156276774724045082950763738220745588162178794956983442120537663290082098435718175595090008280818101641927802222975748674393607971202242769525739960344938437804084025561712107841722146751025532396631398594032513685779740351205942890154107890531633140184093222622940416190701539015901658316660863429584742544767
enc_phi = 19840207208126052393050896123146445177805496265783874787555366857858516052935330306960403961592183751473373113336783003952286599270668928793068877549204823999940315119026834518475426746219794590844048907445041555571500802385655006431029757413493018670534847049116864361020139588952019885318063687075377599453874343200071787019646640135681213633240001421797152429317082014545279895361588266534596193780603674679344513424922133455537575473086842614581934166321608333355766561677109596375346228444932694444899741404922130316880747720090681497631030118590501142755682972178229962327056965679854392757460017072618920053436
enc_flag = 72412956436588163659794507702216740679022063295801848362918793014726410875593585256237131395179507083776614435558606002283272600357543430493831668750258934804467763074469610974232371078220367733112445071566038057031510988823736685885493661304726529973768797443896737895068945938280744554742761213447205261812388460265156145381137737437939290728264362518450107336689840087110140538405279045407196388286029720962370423634914180616756854960009153342741795104340473634808239068971495327157168559173221
secret_hex = "e955413d94640ecbdcb0a72ada86baf4"

# Convertir le secret de sa forme hexadécimale à un entier
secret = int(secret_hex, 16)

# Étape 1: Déchiffrement de enc_phi pour obtenir phi
phi = enc_phi ^ secret

# Étape 2: Factorisation de n (nécessaire pour obtenir p et q)
# Note: La factorisation de n est une opération complexe si n est suffisamment grand.
# Dans un contexte éducatif ou un exemple simplifié, nous supposons avoir accès aux facteurs p et q.
# Voici un exemple de p et q (à remplacer par la vraie factorisation si n'était trop grand)
p = 140012287830463247674281828896610066151957885385781905697724345370240689184925487661419792539345923099878230759727710006663152734791593812681509675899418877807329870736710226704294030430216036408222040761423682927297774126722403576998653130813291724573704631048328155046805994051923141055091853146992144663693
q = 141696827814697442748147798949621007161743443034161146677042365953805943260792297869771535746987503485327184252410826047508801758661870634295686582507644017186266696028752264191820517506619090251032078049468383342721148010633249329425840961216857871124045376294991773162788368122406378881949007354197634315949

# Étape 3: Calcul de la clé privée d = e^(-1) mod phi
d = inverse(e, phi)

# Étape 4: Déchiffrement du flag RSA
flag_decrypted = pow(enc_flag, d, n)

# Convertir l'entier en bytes et afficher le flag
flag = long_to_bytes(flag_decrypted)
print("Flag déchiffré :", flag.decode())